# OpenCode Workspace - Agent Instructions

このディレクトリは OpenCode による AI マッチング処理専用のワークスペースです。

## ⚠️ 重要：作業範囲の制限

**このワークスペース（workspace/）ディレクトリ内のファイルのみにアクセスしてください。**

- ✅ アクセス可能: `candidates.ndjson`, `jobs.ndjson`, `companies.ndjson`, `output/`
- ❌ アクセス禁止: 親ディレクトリ（`../`）やプロジェクトルートのファイル
- ❌ 禁止例: `../job.py`, `../download.py`, `../bot.py` など
- ❌ 権限要求禁止: workspace/ 外のファイルへのアクセス権限を求めない

**全ての処理は workspace/ ディレクトリ内で完結させること。**

---

## 📁 ファイル構成

### 入力データ
- `candidates.ndjson` - 求職者データ（フィルタリング済み）
- `jobs.ndjson` - 求人票データ（フィルタリング済み）
- `companies.ndjson` - 企業データ（全件）

### 出力先
- `output/` - マッチング結果・企業探索結果の出力先
  - `matching_*.csv` - 求人レコメンド結果
  - `matching_*_summary.md` - 求人レコメンドサマリー
  - `companies_*.csv` - 企業探索結果
  - `companies_*_summary.md` - 企業探索サマリー

---

## 🎯 処理の原則

### データの整合性
- CSV、サマリー、ターミナル出力の件数は完全に一致させる
- CSVに89社書いたら、サマリーにも89社全てリストアップし、「検索結果総数: 89社」と明記
- 数字の不一致は絶対に起こさない

### 出力形式
- Salesforce URLは必ず Markdown リンク形式で出力
- 例: `[候補者を開く](https://your-org.lightning.force.com/lightning/r/Contact/{ID}/view)`
- 注意: 実際のURLは環境変数 SALESFORCE_BASE_URL から取得されます

### フィルタリング（企業探索）
検索クエリに「週N出社」などの出社頻度が含まれる場合、**数値的に厳密に判定**すること：

1. **出社頻度の数値抽出ルール:**
   - 「フルリモート」「リモートワークOK」 → 出社0日
   - 「週1出社」 → 出社1日
   - 「週1~2出社」 → 出社2日（範囲の場合は**最大値**を採用）
   - 「週2~3出社」 → 出社3日
   - 「週3出社」 → 出社3日
   - 「月1~2回出社」 → 出社0.5日（週換算）
   - 「リモートワーク可能/頻度要確認」など曖昧な表記 → 数値不明として除外

2. **フィルタリング条件:**
   - 検索クエリが「週1出社」の場合 → 出社日数が**1日以下**の企業のみ選定
   - 検索クエリが「週2出社」の場合 → 出社日数が**2日以下**の企業のみ選定
   - **クエリの数値を超える企業は絶対に選ばない**

3. **数値が近いだけでは選ばない:**
   - 「週1出社」と「週3出社」は言葉は似ているが、数値的には3倍の差がある
   - **文脈的な類似度ではなく、数値的な条件を優先**すること

---

## 🔧 技術的な制約

- 新しいPythonスクリプトは作成せず、既存ツール (Read/Write/Bash) を直接使用
- データはndjson形式 (1行1JSON) なので、適切にパース
- 結果ディレクトリ (output/) が存在しない場合は作成
